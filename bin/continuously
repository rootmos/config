#!/bin/sh

files() {
    git ls-files -z
}

waiter() {
    xargs -0 inotifywait -e close_write,moved_to --format="%f"
}

while true; do
    files | waiter
    $*
done
