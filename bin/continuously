#!/bin/sh -x

files() {
    git ls-files -z $1 2>/dev/null || echo -n $1
}

waiter() {
    xargs -0 inotifywait -e close_write,moved_to --format="%f"
}

target=$1
shift

while true; do
    files $target | waiter
    /bin/sh -c "$*"
done
