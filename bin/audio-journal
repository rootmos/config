#!/bin/sh

set -o errexit

. $(readlink -f $0 | xargs dirname)/audio-journal.lib.sh

clear
read -n1 -s -p "Ready? "

DATE=$(date -Is)
RAW=$TAKES/$DATE.raw.flac
PRE=$TAKES/$DATE.pre.flac
POST=$TAKES/$DATE.post.mp3

clear
take $RAW &
PID=$!
IFS= read -n1 -s CHOICE

kill -INT $PID
wait $PID

if [ -z "$CHOICE" ]; then
    clear
    preprocess $RAW $PRE
    playback $PRE
    read -p "Yay or nay? " CHOICE
    case "$CHOICE" in
        y|Y) postprocess $PRE $POST;;
    esac
fi

$0
