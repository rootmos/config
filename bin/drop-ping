#!/bin/sh

set -o pipefail

measure() {
    timeout 1 httping -G -M -c 1 -f https://ip.rootmos.io \
        | jq .[0].total_ms -r \
        | xargs -I{} calc -p "round({})"
}

MS=$(measure)
if [ $? -eq 0 ]; then
    echo -n "${MS}ms"
else
    echo -n "-"
fi

CITY=$(curl --max-time 1 ip.rootmos.io/city)
if [ $? -eq 0 -a -n "$CITY" ]; then
    echo -n " $CITY"
else
    echo -n " $(curl --max-time 1 ip.rootmos.io/country)"
fi
