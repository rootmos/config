#!/bin/sh -x

resolution() {
    xrandr | grep -Po "[\d]+x[\d]+\+[\d]+\+[\d]+" | cut -d+ -f1
}

width() {
    resolution | cut -dx -f1
}

height() {
    resolution | cut -dx -f2
}

percentage()
{
    echo $((2*$1*$2/100 % 2 + $1*$2/100))
}

y=0
h=12

while getopts ":l:r:" opt; do
    case $opt in
        l)
            alignment=l
            width_in_percent=$OPTARG
            ;;
        r)
            alignment=r
            width_in_percent=$OPTARG
            ;;
        *)
            echo "Unknown option!"
            exit 2
            ;;
    esac
done

pos_opts()
{
    w=$(percentage ${width_in_percent} $(width))
    if [ "$alignment" = "l" ]; then
        x=0
        ta=l
    else 
        x=$(($(width)-${w}))
        ta=r
    fi

    echo "-x ${x} -y ${y} -w ${w} -h ${h} -ta ${ta}"
}
>&1 echo "Creating bar with position: $(pos_opts)"

color_opts="-fg #FFFFFF -bg #1B1D1E"
>&1 echo "Creating bar with colors: ${color_opts}"

dzen2 $(pos_opts) ${color_opts}

